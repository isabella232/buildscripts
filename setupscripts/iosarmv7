IOS_PLATFORMDIR=/Applications/Xcode72.app/Contents/Developer/Platforms/iPhoneOS.platform
export CFLAGS="-mfloat-abi=softfp -arch armv7 -miphoneos-version-min=6.0 -fembed-bitcode"

CMAKE_BUILD_TYPE=Release

if [ "$1" = "-g" ]; then
	CMAKE_BUILD_TYPE=RelWithDebInfo
	shift
fi

cat <<EOF >toolchain.cmake
set(CMAKE_SYSTEM_NAME Darwin)
set(CMAKE_SYSTEM_PROCESSOR arm)
set(CMAKE_C_COMPILER /Applications/Xcode72.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang)
EOF

cmake -G"Unix Makefiles" -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} \
	-DCMAKE_OSX_SYSROOT=$IOS_PLATFORMDIR/Developer/SDKs/iPhoneOS.sdk \
	-DCMAKE_POSITION_INDEPENDENT_CODE=1 -DREQUIRE_SIMD=1 \
	-DCMAKE_TOOLCHAIN_FILE=toolchain.cmake \
	.. ${1+"$@"}
